<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TIMBX - Your Comprehensive Timber Management Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body class="bg-gray-50">
    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
    </div>

    <header class="bg-green-900 text-white p-4 text-center shadow-lg">
        <h1 class="text-4xl font-extrabold tracking-wide">TIMBX</h1>
        <p class="mt-2 text-lg">Your Comprehensive Timber Management Platform</p>
        <p class="text-sm italic mt-1">Connecting landowners, foresters, timber buyers, and contractors for transparent and efficient timber management.</p>
    </header>

    <nav class="bg-green-950 p-2 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex items-center">
            <div class="flex-1">
            </div>

            <div class="flex-none space-x-1">
                <a href="#home" class="text-white hover:bg-green-800 px-3 py-2 rounded-md font-bold transition duration-200">Home</a>
                <a href="#marketplace" class="text-white hover:bg-green-800 px-3 py-2 rounded-md font-bold transition duration-200">Marketplace</a>
                <a href="#properties" class="text-white hover:bg-green-800 px-3 py-2 rounded-md font-bold transition duration-200">My Properties</a>
                <a href="#my-inquiries" class="text-white hover:bg-green-800 px-3 py-2 rounded-md font-bold transition duration-200">My Inquiries</a>
                <a href="#logbook" class="text-white hover:bg-green-800 px-3 py-2 rounded-md font-bold transition duration-200">Logbook</a>
                <a href="#my-projects" class="text-white hover:bg-green-800 px-3 py-2 rounded-md font-bold transition duration-200">My Projects</a>
            </div>

            <div class="flex-1 flex justify-end items-center space-x-2">
                <a href="#my-profile" id="user-display" class="hidden text-white text-sm items-center gap-2 hover:bg-green-800 p-1 rounded-md cursor-pointer" aria-label="My Profile">
                </a>
                <button id="login-button" class="bg-lime-800 hover:bg-lime-700 text-white px-4 py-2 rounded-md font-bold transition duration-200 whitespace-nowrap">Login</button>
                <button id="signup-button" class="bg-amber-700 hover:bg-amber-600 text-white px-4 py-2 rounded-md font-bold transition duration-200 whitespace-nowrap">Sign Up</button>
                <button id="logout-button" class="bg-red-800 hover:bg-red-700 text-white px-4 py-2 rounded-md font-bold transition duration-200 hidden whitespace-nowrap">Logout</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4">
        <section id="home" class="main-section p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-3xl font-semibold text-green-800 mb-4">Welcome to TIMBX</h2>
            <p class="text-gray-700 leading-relaxed">
                TIMBX is revolutionizing the timber industry by bringing transparency, efficiency, and direct connections to landowners, foresters, timber buyers, and contractors. We empower you with the tools and information needed to manage your forest assets, find the best market prices, and connect with trusted professionals across the region.
            </p>
            <div class="mt-8 border-t pt-6">
                <h3 class="text-2xl font-semibold text-green-800 mb-4">Quick Demo Access</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4">
                    <button data-demo-role="landowner" class="bg-emerald-700 hover:bg-emerald-600 text-white px-4 py-2 rounded-md font-bold transition duration-200 shadow">Demo Landowner</button>
                    <button data-demo-role="timber-buyer" class="bg-teal-700 hover:bg-teal-600 text-white px-4 py-2 rounded-md font-bold transition duration-200 shadow">Demo Timber Buyer</button>
                    <button data-demo-role="forester" class="bg-lime-700 hover:bg-lime-600 text-white px-4 py-2 rounded-md font-bold transition duration-200 shadow">Demo Forester</button>
                    <button data-demo-role="logging-contractor" class="bg-indigo-700 hover:bg-indigo-600 text-white px-4 py-2 rounded-md font-bold transition duration-200 shadow">Demo Logging Contractor</button>
                    <button data-demo-role="service-provider" class="bg-purple-700 hover:bg-purple-600 text-white px-4 py-2 rounded-md font-bold transition duration-200 shadow">Demo Service Provider</button>
                </div>
            </div>
        </section>

        <section id="marketplace" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-3xl font-semibold text-green-800 mb-4">Marketplace</h2>
            <div id="map-filters" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-4 p-4 bg-gray-100 rounded-md items-start">
                <div class="filter-group">
                    <label class="filter-group-label"><input type="checkbox" id="filter-projects" class="mr-2 h-4 w-4" checked><span style="color: #4f46e5;">&#9733;</span>Projects</label>
                </div>
                <div class="filter-group">
                    <label class="filter-group-label"><input type="checkbox" id="filter-buyers" class="mr-2 h-4 w-4" checked><span class="legend-dot" style="background-color: #78350f;"></span>Timber Buyers</label>
                </div>
                <div class="filter-group">
                    <label class="filter-group-label"><input type="checkbox" id="filter-foresters" class="mr-2 h-4 w-4" checked><span class="legend-dot" style="background-color: #57534e;"></span>Foresters</label>
                    <select id="filter-forester-services" class="filter-group-select hidden"></select>
                </div>
                <div class="filter-group">
                    <label class="filter-group-label"><input type="checkbox" id="filter-logging-contractors" class="mr-2 h-4 w-4" checked><span class="legend-dot" style="background-color: #a16207;"></span>Logging</label>
                    <select id="filter-logging-contractor-services" class="filter-group-select hidden"></select>
                </div>
                <div class="filter-group">
                    <label class="filter-group-label"><input type="checkbox" id="filter-service-providers" class="mr-2 h-4 w-4" checked><span class="legend-dot" style="background-color: #4d7c0f;"></span>Services</label>
                    <select id="filter-service-provider-services" class="filter-group-select hidden"></select>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 relative">
                    <div id="global-map"></div>
                    <button id="search-this-area-btn" class="hidden absolute top-4 left-1/2 -translate-x-1/2 z-[1000] bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:bg-blue-700 transition">
                        Search This Area
                    </button>
                </div>
                <div class="lg:col-span-1 p-2 border border-gray-200 rounded-md bg-gray-50 h-[600px] overflow-y-auto">
                    <h3 class="font-bold text-lg text-gray-800 mb-2 text-center">Showing items in map view</h3>
                    <ul id="dynamic-map-list"></ul>
                </div>
            </div>
        </section>
         
        <section id="properties" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <div id="properties-login-prompt" class="text-center p-6 bg-white rounded-lg shadow-md">
                <h2 class="text-2xl font-bold mb-4 text-green-800">Manage Your Properties</h2>
                <p>Please log in as a Landowner to add and manage your property listings.</p>
            </div>
            <div id="properties-main-content" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-semibold text-green-800">My Properties</h2>
                    <button id="btn-add-property" class="bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow">
                        + Add New Property
                    </button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 relative">
                        <div id="my-properties-map"></div>
                    </div>
                    <div class="lg:col-span-1 p-2 border border-gray-200 rounded-md bg-gray-50 h-[600px] overflow-y-auto">
                        <h3 class="font-bold text-lg text-gray-800 mb-2 text-center">Your Properties</h3>
                        <ul id="my-properties-list-container" class="space-y-2"></ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="add-edit-property" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="property-form-title" class="text-3xl font-semibold text-green-800">Add New Property</h2>
                    <a href="#properties" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">&larr; Back to My Properties</a>
                </div>
                <p class="text-sm text-gray-600 mb-6">Fields marked with <span class="text-red-500 font-bold">*</span> are required. All others are optional but recommended for a complete listing.</p>
                <form id="property-form" class="space-y-6">
                    <input type="hidden" id="property-id">
                    
                    <div>
                        <label for="property-name" class="font-bold">Property Name <span class="text-red-500 font-bold">*</span></label>
                        <input type="text" id="property-name" class="w-full p-2 border rounded mt-1" required>
                    </div>
        
                    <div>
                         <label class="font-bold">Property Boundary <span class="text-red-500 font-bold">*</span></label>
                         <div class="w-full h-[400px] mt-1" id="property-map"></div>
                         <p class="mt-1">Calculated Acreage: <span id="calculated-acreage" class="font-bold">0.00</span> acres</p>
                    </div>
                     
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Property Identification</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="property-county" placeholder="County" class="w-full p-2 border rounded">
                            <input type="text" id="property-state" placeholder="State" class="w-full p-2 border rounded">
                            <input type="text" id="property-apn" placeholder="Assessor Parcel Number (APN)" class="w-full p-2 border rounded">
                            <input type="text" id="property-str" placeholder="Section, Township, Range" class="w-full p-2 border rounded">
                        </div>
                    </div>
        
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Land Characteristics</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <select id="property-topography" class="w-full p-2 border rounded">
                                <option value="">Select Topography...</option>
                                <option>Flat</option>
                                <option>Rolling</option>
                                <option>Steep</option>
                            </select>
                             <select id="property-accessibility" class="w-full p-2 border rounded">
                                <option value="">Select Site Access...</option>
                                <option>Paved Road Frontage</option>
                                <option>Gravel Road Frontage</option>
                                <option>Dirt Road / Deeded Easement</option>
                                <option>Landlocked / No Deeded Access</option>
                            </select>
                        </div>
                    </div>
        
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Timber Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                             <select id="property-timber-type" class="w-full p-2 border rounded">
                                <option value="">Select Dominant Timber Type...</option>
                                <option>Pine Plantation</option>
                                <option>Natural Pine</option>
                                <option>Upland Hardwood</option>
                                <option>Bottomland Hardwood</option>
                                <option>Mixed Pine/Hardwood</option>
                                <option>Pre-merchantable / Young Growth</option>
                            </select>
                            <input type="text" id="property-species" placeholder="Dominant Species" class="w-full p-2 border rounded">
                            <input type="number" id="property-age" placeholder="Approx. Stand Age (years)" class="w-full p-2 border rounded">
                            <input type="number" id="property-basal-area" placeholder="Avg. Basal Area (sqft/ac)" class="w-full p-2 border rounded">
                            <input type="number" id="property-site-index" placeholder="Site Index (base age 50)" class="w-full p-2 border rounded">
                            <input type="number" id="property-previous-cut-year" placeholder="Last Harvest Year" class="w-full p-2 border rounded">
                             <select id="property-previous-cut-type" class="w-full p-2 border rounded">
                                <option value="">Select Last Harvest Type...</option>
                                <option>Clear Cut</option>
                                <option>First Thinning</option>
                                <option>Second Thinning</option>
                                <option>Third+ Thinning</option>
                                <option>Selection Harvest</option>
                                <option>No Recent Harvest</option>
                            </select>
                        </div>
                    </div>
                     
                    <div class="border-t pt-4">
                         <h4 class="font-semibold text-lg mb-2">Description & Notes</h4>
                        <textarea id="property-desc" placeholder="Provide a detailed description of the property, including any improvements, hunting potential, water features, etc." class="w-full p-2 border rounded" rows="4"></textarea>
                    </div>
                     
                    <div class="flex gap-4 pt-4 border-t">
                        <button id="btn-save-property" type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold w-full">Save Property</button>
                        <a href="#properties" class="bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-lg font-bold w-full text-center">Cancel</a>
                    </div>
                </form>
            </div>
        </section>

        <section id="my-inquiries" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h2 class="text-3xl font-semibold text-green-800">My Inquiries</h2>
                <label class="flex items-center text-sm font-medium text-gray-700">
                    <input type="checkbox" id="show-archived-checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2">
                    Show Archived
                </label>
            </div>
            <div id="inquiries-login-prompt" class="text-center p-6 bg-white rounded-lg shadow-md">
                <p>Please log in as a professional to view your inquiries.</p>
            </div>
            <div id="inquiries-main-content" class="hidden space-y-4">
            </div>
        </section>

        <section id="logbook" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 border-b pb-4">
                <h2 class="text-3xl font-semibold text-green-800">Timbx Logbook</h2>
                <div id="logbook-nav" class="flex space-x-2 mt-4 md:mt-0">
                    <button id="btn-view-loads" class="logbook-nav-btn bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Loads Dashboard</button>
                    <button id="btn-log-new-load" class="logbook-nav-btn bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg">Log New Load</button>
                </div>
            </div>
             
            <div id="logbook-view-loads">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-semibold text-gray-700">Submitted Loads</h3>
                    <div class="flex items-center space-x-4">
                        <label for="loads-job-filter" class="text-sm font-medium">Filter by Job:</label>
                        <select id="loads-job-filter" class="p-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="all">All Active Jobs</option>
                        </select>
                    </div>
                </div>
                <div id="my-loads-container" class="space-y-4">
                    <p class="text-center text-gray-500 p-4">Loading your submitted loads...</p>
                </div>
                <div id="my-loads-summary" class="mt-6 pt-4 border-t-2 border-green-700 text-right">
                    <h3 class="text-xl font-bold">Total Net Tons: <span id="total-net-tons" class="text-green-800">0.00</span></h3>
                </div>
            </div>

            <div id="logbook-log-new" class="hidden max-w-2xl mx-auto">
                 <h3 class="text-2xl font-semibold text-gray-700 mb-6 text-center">Log a New Load</h3>
                 <form id="log-load-form" class="space-y-4">
                    <div>
                        <label for="load-job" class="block text-sm font-medium text-gray-700">Select Job/Project</label>
                        <select id="load-job" name="job" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" required>
                            <option value="">Loading active jobs...</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="load-date" class="block text-sm font-medium text-gray-700">Date & Time</label>
                            <input type="datetime-local" id="load-date" name="date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" required>
                        </div>
                        <div>
                            <label for="load-mill" class="block text-sm font-medium text-gray-700">Destination Mill</label>
                            <select id="load-mill" name="mill" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" required>
                                <option value="">Select a Mill</option>
                                <option value="Mill A">Mill A</option>
                                <option value="Mill B">Mill B</option>
                                <option value="Mill C">Mill C</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="load-product" class="block text-sm font-medium text-gray-700">Product</label>
                        <select id="load-product" name="product" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" required>
                            <option value="">Select a Product</option>
                            <option value="Pine Pulpwood">Pine Pulpwood</option>
                            <option value="Pine Sawtimber">Pine Sawtimber</option>
                            <option value="Hardwood Pulpwood">Hardwood Pulpwood</option>
                            <option value="Hardwood Sawtimber">Hardwood Sawtimber</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                        <div>
                            <label for="load-gross-weight" class="block text-sm font-medium text-gray-700">Gross Weight (lbs)</label>
                            <input type="number" id="load-gross-weight" name="grossWeight" placeholder="e.g., 80000" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" required>
                        </div>
                        <div>
                            <label for="load-tare-weight" class="block text-sm font-medium text-gray-700">Tare Weight (lbs)</label>
                            <input type="number" id="load-tare-weight" name="tareWeight" placeholder="e.g., 35000" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" required>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-700">Net Weight (Tons)</p>
                            <p id="load-net-weight" class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md font-bold text-lg">0.00</p>
                        </div>
                    </div>
                    <div>
                        <label for="load-ticket-photo" class="block text-sm font-medium text-gray-700">Load Ticket Photo (Optional)</label>
                        <input type="file" id="load-ticket-photo" name="ticketPhoto" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-100 file:text-green-700 hover:file:bg-green-200" accept="image/*">
                    </div>
                    <div class="pt-4 border-t">
                        <button type="submit" class="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">Submit Ticket</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="my-projects" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-3xl font-semibold text-green-800 mb-4">My Projects</h2>
            <div id="my-projects-container" class="space-y-6">
            </div>
        </section>

        <section id="my-profile" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <h2 class="text-3xl font-semibold text-green-800 mb-4">My Profile</h2>
            <p id="profile-login-prompt" class="text-red-600 mb-4 hidden">Please log in to view your profile.</p>
            <div id="profile-details" class="hidden">
                <div class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6 mb-6">
                    <img id="profile-picture-display" src="" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-green-200 shadow-md">
                    <div class="text-center sm:text-left">
                        <h3 id="profile-username" class="text-3xl font-bold text-gray-800"></h3>
                        <p id="profile-company" class="text-lg text-gray-600"></p>
                        <p class="text-lg font-semibold text-gray-800">Role: <span id="profile-role" class="font-normal text-gray-700"></span></p>
                    </div>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 pt-6 border-t">
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-xl font-semibold text-green-800 border-b pb-2 mb-2">About Me</h4>
                            <p id="profile-bio" class="text-gray-700 leading-relaxed"></p>
                        </div>
                        <div id="profile-role-specific-data">
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div>
                           <h4 class="text-xl font-semibold text-green-800 border-b pb-2 mb-2">Statistics</h4>
                            <div class="flex flex-wrap gap-4 text-center">
                                <div class="bg-gray-100 p-3 rounded-lg flex-grow"><p class="text-2xl font-bold text-amber-600" id="profile-rating"></p><p class="text-sm text-gray-600">Rating (<span id="profile-review-count"></span> reviews)</p></div>
                                <div class="bg-gray-100 p-3 rounded-lg flex-grow"><p class="text-2xl font-bold text-lime-700" id="profile-transactions"></p><p class="text-sm text-gray-600">Completed Transactions</p></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-xl font-semibold text-green-800 border-b pb-2 mb-2">Contact</h4>
                            <p class="text-sm text-gray-700">Email: <span id="profile-email" class="font-normal text-gray-700"></span></p>
                            <p class="text-sm text-gray-500">Member since: <span id="profile-member-since"></span></p>
                        </div>
                        <div id="profile-map-container" class="hidden">
                            <h4 class="text-xl font-semibold text-green-800 border-b pb-2 mb-2">Service Area</h4>
                            <div id="profile-map-display" class="w-full h-64 rounded-lg border"></div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t">
                    <button id="edit-my-profile-button" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-bold transition duration-200">Edit Profile</button>
                </div>
            </div>
        </section>
        
        <section id="add-edit-cruise" class="main-section hidden p-6 bg-white rounded-lg shadow-md mb-6">
            <div class="max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="timber-sale-form-title" class="text-3xl font-semibold text-green-800">Enter Cruise Data</h2>
                    <a href="#my-projects" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">&larr; Back to My Projects</a>
                </div>
                 <p class="text-sm text-gray-600 mb-6">Provide as much detail as possible to attract the best bids. Fields are optional unless otherwise noted.</p>
                <form id="timber-sale-form" class="space-y-6">
                    <input type="hidden" id="timber-sale-property-id">
        
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Sale Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" id="sale-name" placeholder="Sale Name / Tract Name" class="md:col-span-3 w-full p-2 border rounded">
                            <select id="sale-type" class="w-full p-2 border rounded">
                                <option value="lump-sum">Lump Sum Bid</option>
                                <option value="pay-as-cut">Pay-as-Cut (Per Unit)</option>
                            </select>
                            <div>
                                <label for="bid-deadline" class="text-sm font-medium text-gray-700">Bid Deadline</label>
                                <input type="date" id="bid-deadline" class="w-full p-2 border rounded">
                            </div>
                        </div>
                    </div>
        
                    <div class="border-t pt-4">
                         <h4 class="font-semibold text-lg mb-2">Property, Access & Conditions</h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="sale-county" placeholder="County" class="w-full p-2 border rounded">
                            <input type="text" id="sale-state" placeholder="State" class="w-full p-2 border rounded">
                            <input type="number" step="0.01" id="sale-acreage" placeholder="Harvest Acreage" class="w-full p-2 border rounded">
                            <input type="text" id="sale-legal-desc" placeholder="Legal Description (STR)" class="w-full p-2 border rounded">
                            <textarea id="sale-access-desc" placeholder="Detailed Access Description (road names, gates, key access)" class="md:col-span-2 w-full p-2 border rounded" rows="3"></textarea>
                            <select id="sale-logging-conditions" class="w-full p-2 border rounded">
                                <option value="">Select Logging Conditions...</option>
                                <option>Excellent / Dry Year-Round</option>
                                <option>Good / Mostly Dry</option>
                                <option>Average / Seasonally Wet</option>
                                <option>Difficult / Mostly Wet</option>
                            </select>
                         </div>
                    </div>
        
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Harvest Specifications</h4>
                        <textarea id="sale-harvest-desc" placeholder="Harvest Description (e.g., clearcut, first thinning, seed tree)" class="w-full p-2 border rounded" rows="3"></textarea>
                        <textarea id="sale-boundary-desc" placeholder="Boundary Line Description (e.g., flagged in pink, blue paint lines, follows creek)" class="w-full p-2 border rounded" rows="3"></textarea>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <select id="sale-smz-rules" class="w-full p-2 border rounded"><option value="">SMZ / Riparian Rules...</option><option>Marked to cut</option><option>No cut</option><option>As per state BMPs</option></select>
                             <input type="number" id="sale-stump-height" placeholder="Max Stump Height (inches)" class="w-full p-2 border rounded">
                        </div>
                    </div>
                     
                     <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Contract Terms</h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="number" id="sale-contract-length" placeholder="Contract Length (months)" class="w-full p-2 border rounded">
                            <input type="text" id="sale-performance-bond-amount" placeholder="Performance Bond Amount ($)" class="w-full p-2 border rounded">
                            <input type="text" id="sale-insurance-gli" placeholder="General Liability Insurance ($)" class="w-full p-2 border rounded">
                            <input type="text" id="sale-insurance-wc" placeholder="Workers' Comp Insurance ($)" class="w-full p-2 border rounded">
                            <label class="flex items-center"><input type="checkbox" id="sale-guarantee-tally" class="mr-2 h-4 w-4"> Seller Guarantees Tally</label>
                         </div>
                         <textarea id="sale-more-conditions" placeholder="Other Conditions / Remarks" class="w-full p-2 border rounded mt-4" rows="3"></textarea>
                    </div>
        
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-lg mb-2">Harvest Map & Timber Inventory</h4>
                        <p class="text-sm text-gray-600 mb-2">Use the map tools to draw harvest areas, streamside zones (SMZs), roads, and landing sites. Then, add inventory volumes for each stand.</p>
                        <div class="w-full h-[500px]" id="timber-sale-map"></div>
                        <div id="map-legend" class="mt-2 p-2 border rounded bg-gray-50 text-sm"></div>
                        <div class="p-4 bg-gray-100 rounded-md my-4 text-sm grid grid-cols-2 gap-x-4">
                            <div><strong>Total Mapped Acres (All Stands):</strong> <span id="total-gross-acres" class="font-bold">0.00</span></div>
                            <div><strong>Total Net Acres (All Stands):</strong> <span id="total-net-acres" class="font-bold">0.00</span></div>
                        </div>
                        <div id="timber-inventory-stands-container" class="mt-4"></div>
                        <button type="button" id="add-inventory-stand-btn" class="text-blue-600 mt-2 font-semibold">+ Add Stand / Harvest Area</button>
                        
                        <div id="inventory-summary-container" class="mt-6 pt-4 border-t-2 border-gray-300">
                            <h4 class="font-semibold text-lg mb-2">Live Inventory Summary (All Stands)</h4>
                            <div class="p-4 bg-gray-50 rounded-md border text-sm space-y-1">
                                <div class="flex justify-between font-mono"><p>Pine Sawtimber:</p><p><span id="total-pine-sawtimber">0.00</span> Tons</p></div>
                                <div class="flex justify-between font-mono"><p>Pine Chip-n-Saw:</p><p><span id="total-pine-cns">0.00</span> Tons</p></div>
                                <div class="flex justify-between font-mono"><p>Pine Pulpwood:</p><p><span id="total-pine-pulpwood">0.00</span> Tons</p></div>
                                <div class="flex justify-between font-mono"><p>Hardwood Sawtimber:</p><p><span id="total-hardwood-sawtimber">0.00</span> Tons</p></div>
                                <div class="flex justify-between font-mono"><p>Hardwood Pulpwood:</p><p><span id="total-hardwood-pulpwood">0.00</span> Tons</p></div>
                                <div class="flex justify-between font-bold border-t mt-2 pt-1"><p>TOTAL VOLUME:</p><p><span id="total-all-products">0.00</span> Tons</p></div>
                            </div>
                        </div>
                    </div>
                     
                    <div class="flex gap-4 pt-4 border-t">
                        <button id="btn-submit-sale-form" type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold w-full">Submit Cruise for Review</button>
                        <a href="#my-projects" class="bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-lg font-bold w-full text-center">Cancel</a>
                        <button id="btn-accept-cruise-report" type="button" class="bg-green-600 text-white p-3 rounded font-bold" style="display: none;">Accept Cruise</button>
                        <button id="btn-start-timber-sale" type="button" class="bg-amber-600 text-white p-3 rounded font-bold" style="display: none;">Start Timber Sale</button>
                    </div>
                </form>
            </div>
        </section>

    </main>
     
    <div id="modal-container">
        </div>
     
    <script>
        // This script fetches the modal HTML and injects it into the page.
        fetch('modals.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modal-container').innerHTML = html;
            })
            .catch(error => {
                console.error('Error loading modals:', error);
            });
    </script>
     
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geometryutil/0.10.2/leaflet.geometryutil.min.js"></script>

    <script type="module" src="js/main.js"></script>

</body>
</html>